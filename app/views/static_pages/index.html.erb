<%= render 'layouts/header' %>

<div class="content">
  <% if false %>
  <%= render 'filter' %>
  <% end %>

  <div class="col-md-6 eventColumn">
    <span id="today">
      <%= @left_name %>
    </span>

    <div class="eventList">

      <% for el in @events_today %>
      <% e = el[0] %>
      <% f = FavoriteEvent.where(event_id: el.map(&:id), user_id: @user.id)[0] %>
      <% f ||= FavoriteEvent.new(event_id: e.id, user_id: @user.id) %>
      <li>

        <div class="bigEvent" style="<%= big_event_style(e) %>"
             data-ids="<%= el.map(&:id) %>"
             data-cal="<%= f.gcal || false %>"
             data-email="<%= f.email || false %>"
             data-sms="<%= f.sms || false %>" >


          <div class="topright">
            <a class="<%= if f.gcal then 'gcalLinkChosen' else 'gcalLink' end %>
                      linkIcon Hidden"
               data-link="<%= gcal_link(e) %>"
               title="Add to Google Calendar" ></a>

            <a class="<%= if f.sms then 'smsLinkChosen' else 'smsLink' end %>
                      linkIcon Hidden"
               title="Remind me by SMS"></a>
            
            <a class="<%= if f.email then 'emailLinkChosen' else 'emailLink' end %>
                      linkIcon Hidden"
               title="Remind me by Email"></a>
            
          </div>

          
          <span class="tagger" style="background-color: <%= @gcols[e.group_id] %>;">
            <%= el.map { |x| @gnames[x.group_id] }.uniq.join(' / ') %>
          </span>

          <% if @logged %>


          <% if @user.favorites.exists?(e.id) %>

          <%= render 'favdeselect', e: e %>

          <% else %>

          <%= render 'favselect', e: e %>

          <% end %>

          <% end %>

          <div class="events"><%= CGI.unescapeHTML(e.title) %></div>
          <div class="dateloc">
            <span class="date"> 
              <%= e.start_at.strftime('%I:%M %P') %> &#8212;
              <%= e.end_at.strftime('%I:%M %P')  %>
            </span>

            <% if e.location.length >= StaticPagesHelper::LOCATION_CUTOFF %>
            <br/> 
            <% end %>

            <div class="loc"
                 style="<%= 'float: right;' \
                        if e.location.length < StaticPagesHelper::LOCATION_CUTOFF %>">
              <%= e.location  %>
            </div>

            <% if not e.description.blank? %>
            <div class="desc ellipsis">
              <span class="eventColon">Description:</span>
              <%= simple_format(e.description, {}, wrapper_tag: "span") %>
            </div>
            <% end %>

          </div>
        </div>
      </li>
      <% end %>
    </div>
  </div>


  <div class="col-md-6 eventColumn" >

    <span id="upcoming">
      Upcoming
    </span>

    <div class="eventList" id="upcomingList">

      <% for el in @events_upcoming %>
      <% e = el[0] %>
      <% f = FavoriteEvent.where(event_id: el.map(&:id), user_id: @user.id)[0] %>
      <% f ||= FavoriteEvent.new(event_id: e.id, user_id: @user.id) %>
      <li>
        <div class="bigEvent" style="<%= big_event_style(e) %>"
             data-ids="<%= el.map(&:id) %>"
             data-cal="<%= f.gcal || false %>"
             data-email="<%= f.email || false %>"
             data-sms="<%= f.sms || false %>" >


          <div class="topright">
            <a class="<%= if f.gcal then 'gcalLinkChosen' else 'gcalLink' end %>
                      linkIcon Hidden"
               data-link="<%= gcal_link(e) %>"
               title="Add to Google Calendar" ></a>

            <a class="<%= if f.sms then 'smsLinkChosen' else 'smsLink' end %>
                      linkIcon Hidden"
               title="Remind me by SMS"></a>
            
            <a class="<%= if f.email then 'emailLinkChosen' else 'emailLink' end %>
                      linkIcon Hidden"
               title="Remind me by Email"></a>
            
          </div>

          <span class="tagger" style="background-color: <%= @gcols[e.group_id] %>;">
            <%= el.map { |x| @gnames[x.group_id] }.uniq.join(' / ') %>
          </span>

          <% if @logged %>

          <% if @user.favorites.exists?(e.id) %>

          <%= render 'favdeselect', e: e %>

          <% else %>

          <%= render 'favselect', e: e %>

          <% end %>

          <% end %>

          <div class="events"><%= CGI.unescapeHTML(e.title) %></div>
          <div class="dateloc">
            <span class="date"> 
              <%= e.start_at.strftime('%a %b %e | %I:%M %P') %> &#8212;
              <%= e.end_at.strftime('%I:%M %P') %>
            </span>

            <% if e.location.length >= StaticPagesHelper::LOCATION_CUTOFF %>
            <br/>
            <% end %>

            <div class="loc"
                 style="<%= 'float: right;' \
                        if e.location.length < StaticPagesHelper::LOCATION_CUTOFF %>">
              <%= e.location  %>
            </div>

            <% if not e.description.blank? %>
            <div class="desc ellipsis">
              <span class="eventColon">Description:</span>
              <%= simple_format(e.description, {}, wrapper_tag: "span") %>
            </div>
            <% end %>

          </div>
        </div>
      </li>
      <% end %>

      <% if false %>
      <%= will_paginate @events_upcoming, :renderer => WillPaginate::ActionView::LinkRenderer %>
      <% end %>
    </div>
  </div>
</div>

<div id="loadingDiv" class="Hidden">
</div>
